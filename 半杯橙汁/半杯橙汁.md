> 该笔记记录工作中学习开发分布式性能监控项目中学习到的技能和知识点。

# Docker

## Docker和虚拟机的区别：

+ 虚拟机会通过Hypervisor(虚拟机管理系统，就是VMware,VirtualBox这些)，虚拟出网卡，cpu，内存等虚拟硬件，再在上面建立起虚拟机，每个虚拟机是独立的操作系统，有自己的系统内核
+ 容器则是利用**namespace**将文件系统，进程，网络，设备等资源进行隔离；利用**cgroup**对权限、cpu资源进行限制，最终可以使容器之间互不影响

## 容器的整体流程：

+ 命名空间隔离：容器启动时，他的进程以及相关的资源都被置于独立的命名空间中，这样容器中的进程只能看到自己的命名空间，而不会感知到主机或者其他容器的存在
+ Cgroup控制：使用cgroup，哦容器的资源使用可以被限制和控制，例如可以限制容器使用的CPU百分比，内存量等。

## Docker的优势：

> docker就相当于一个进程

+ 直接使用宿主机的硬件资源，因此在cpu、内存、利用率上，Docker将会在效率上有更大的优势
+ Docker直接利用宿主机的系统内核，避免了虚拟机启动时所需要的系统引导时间和操作系统运行的资源消耗，利用Docker可以在几秒钟之内启动大量的容器，是虚拟机无法半岛的。快速启动，低资源消耗的优点，使Docker在弹性云平台的自动运维系统方面具有很好的应用场景(结合K8s集群管理)
+ 容器的启动是秒级的，大量节约开发、测试、部署的时间。更关键的是，Docker可以更高效的部署和扩容，Docker几乎可以在任何平台运行，包括虚拟机、物理机、公有云、私有云、个人电脑、服务器等，这种兼容性，可以让用户把一个应用程序从一个平台直接迁移到另外一个平台
+ 但是，虚拟机的安全性比容器好一些，docker与宿主机共享内核、文件系统等资源，可能对其他容器和宿主机造成影响

## Docker的基本组成：

> 相关概念：
>
> + 镜像：镜像类似于一个模板，或者说是容器的静态版本。镜像运行起来就是容器
> + 容器：可以简单理解成微型虚拟机，但是没有自己的资源，都依赖宿主机的资源。（类似进程与线程的关系）

+ 客户端
+ 服务器
+ 仓库：存储镜像文件

## Docker的常用命令

### 帮助命令：

```shell
docker version		# 显示docker版本信息
docker info			#显示docker的系统信息，包括镜像和容器的数量
docker 命令 --help   #帮助命令
```

### 镜像命令：

#### docker images：查看本地镜像

```shell
[root@test /]# docker images
RESPOSITORY		TAG		IMAGE ID		CREATED		SIZE
hello-world		latest	salskdfj		1 days ago	13.3kB

# 解释
RESPOSITORY 镜像的仓库源
TAG			镜像的标签
IMAGE ID	镜像ID
CREATED		镜像的创建时间
SIZE		镜像的大小

# 可选项
-a,--all	# 列出所有镜像
-q,--quiet	# 只显示镜像的id
```

#### docker search：搜索镜像

```shell
[root@test /]# docker search mysql
NAME	DESCRIPITION	STARS	OFFICIAL
mysql	...				9494	[OK]		
mariadb	...				3441	[OK]
...

# 可选项，过滤条件
--filter=STARS=3000 #搜索STARS大于3000的
# 示例
[root@test /]# docker search mysql --filter=STARS=3000
NAME	DESCRIPITION	STARS	OFFICIAL
mysql	...				9494	[OK]		
mariadb	...				3441	[OK]

[root@test /]# docker search mysql --filter=STARS=5000
NAME	DESCRIPITION	STARS	OFFICIAL
mysql	...				9494	[OK]		
```

#### docker pull:拉取镜像

```shell
# docker pull name[:tag=latest]
[root@test /]# docker pull mysql
using default tag:latest	# 默认tag为latest
...
Digest:sha256:...			# 签名
Status:Downloaded newer image for mysql:latest
docker.io/library/mysql:latest # 真实地址

# 以下命令等价
docker pull mysql
docker pull docker.io/library/mysql:latest
```

#### docker rmi:删除镜像

```shell
[root@test /]# docker rmi -f 容器ID
[root@test /]# docker rmi -f 容器ID 容器ID 容器ID
[root@test /]# docker rmi -f $(docker images -aq) #删除全部容器
```

#### docker tag：镜像打标签

```shell
# docker tag 镜像ID 命名容器
[root@test /]#docker tag docker.io/centos docker.io/centos:v1
```

### 容器命令

#### docker run:新建容器并启动

```shell
# docker run [param] image

#参数说明
--name=""	# 容器名称
-d			#
-it
-p
	-p
	-p
	-
	
```

